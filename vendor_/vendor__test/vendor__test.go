// Code generated by Fern. DO NOT EDIT.

package vendor__test

import (
	bytes "bytes"
	context "context"
	json "encoding/json"
	payabli "github.com/payabli/sdk-go"
	client "github.com/payabli/sdk-go/client"
	option "github.com/payabli/sdk-go/option"
	require "github.com/stretchr/testify/require"
	http "net/http"
	testing "testing"
)

func ResetWireMockRequests(
	t *testing.T,
) {
	WiremockAdminURL := "http://localhost:8080/__admin"
	_, err := http.Post(WiremockAdminURL+"/requests/reset", "application/json", nil)
	require.NoError(t, err)
}

func VerifyRequestCount(
	t *testing.T,
	method string,
	urlPath string,
	queryParams map[string]string,
	expected int,
) {
	WiremockAdminURL := "http://localhost:8080/__admin"
	var reqBody bytes.Buffer
	reqBody.WriteString(`{"method":"`)
	reqBody.WriteString(method)
	reqBody.WriteString(`","urlPath":"`)
	reqBody.WriteString(urlPath)
	reqBody.WriteString(`"}`)
	if len(queryParams) > 0 {
		reqBody.WriteString(`,"queryParameters":{`)
		first := true
		for key, value := range queryParams {
			if !first {
				reqBody.WriteString(",")
			}
			reqBody.WriteString(`"`)
			reqBody.WriteString(key)
			reqBody.WriteString(`":{"equalTo":"`)
			reqBody.WriteString(value)
			reqBody.WriteString(`"}`)
			first = false
		}
		reqBody.WriteString("}")
	}
	resp, err := http.Post(WiremockAdminURL+"/requests/find", "application/json", &reqBody)
	require.NoError(t, err)
	var result struct {
		Requests []interface{} `json:"requests"`
	}
	json.NewDecoder(resp.Body).Decode(&result)
	require.Equal(t, expected, len(result.Requests))
}

func TestVendorAddVendorWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.VendorData{
		VendorNumber: payabli.String(
			"1234",
		),
		Name1: payabli.String(
			"Herman's Coatings and Masonry",
		),
		Name2: payabli.String(
			"<string>",
		),
		Ein: payabli.String(
			"12-3456789",
		),
		Phone: payabli.String(
			"5555555555",
		),
		Email: payabli.String(
			"example@email.com",
		),
		Address1: payabli.String(
			"123 Ocean Drive",
		),
		Address2: payabli.String(
			"Suite 400",
		),
		City: payabli.String(
			"Miami",
		),
		State: payabli.String(
			"FL",
		),
		Zip: payabli.String(
			"33139",
		),
		Country: payabli.String(
			"US",
		),
		Mcc: payabli.String(
			"7777",
		),
		LocationCode: payabli.String(
			"MIA123",
		),
		Contacts: []*payabli.Contacts{
			&payabli.Contacts{
				ContactName: payabli.String(
					"Herman Martinez",
				),
				ContactEmail: payabli.String(
					"example@email.com",
				),
				ContactTitle: payabli.String(
					"Owner",
				),
				ContactPhone: payabli.String(
					"3055550000",
				),
			},
		},
		BillingData: &payabli.BillingData{
			Id: payabli.Int(
				123,
			),
			BankName: payabli.String(
				"Country Bank",
			),
			RoutingAccount: payabli.String(
				"123123123",
			),
			AccountNumber: payabli.String(
				"123123123",
			),
			TypeAccount: payabli.TypeAccountChecking.Ptr(),
			BankAccountHolderName: payabli.String(
				"Gruzya Adventure Outfitters LLC",
			),
			BankAccountHolderType: payabli.BankAccountHolderTypeBusiness.Ptr(),
			BankAccountFunction: payabli.Int(
				0,
			),
		},
		PaymentMethod: payabli.String(
			"managed",
		),
		VendorStatus: payabli.Int(
			1,
		),
		RemitAddress1: payabli.String(
			"123 Walnut Street",
		),
		RemitAddress2: payabli.String(
			"Suite 900",
		),
		RemitCity: payabli.String(
			"Miami",
		),
		RemitState: payabli.String(
			"FL",
		),
		RemitZip: payabli.String(
			"31113",
		),
		RemitCountry: payabli.String(
			"US",
		),
		PayeeName1: payabli.String(
			"<string>",
		),
		PayeeName2: payabli.String(
			"<string>",
		),
		CustomerVendorAccount: payabli.String(
			"A-37622",
		),
		InternalReferenceId: payabli.Int64(
			123,
		),
	}
	_, invocationErr := client.Vendor.AddVendor(
		context.TODO(),
		"8cfec329267",
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "POST", "/Vendor/single/8cfec329267", nil, 1)
}

func TestVendorDeleteVendorWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Vendor.DeleteVendor(
		context.TODO(),
		1,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "DELETE", "/Vendor/1", nil, 1)
}

func TestVendorEditVendorWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.VendorData{
		Name1: payabli.String(
			"Theodore's Janitorial",
		),
	}
	_, invocationErr := client.Vendor.EditVendor(
		context.TODO(),
		1,
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "PUT", "/Vendor/1", nil, 1)
}

func TestVendorGetVendorWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Vendor.GetVendor(
		context.TODO(),
		1,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Vendor/1", nil, 1)
}
