// Code generated by Fern. DO NOT EDIT.

package boarding_test

import (
	bytes "bytes"
	context "context"
	json "encoding/json"
	payabli "github.com/payabli/sdk-go"
	client "github.com/payabli/sdk-go/client"
	option "github.com/payabli/sdk-go/option"
	require "github.com/stretchr/testify/require"
	http "net/http"
	testing "testing"
)

func ResetWireMockRequests(
	t *testing.T,
) {
	WiremockAdminURL := "http://localhost:8080/__admin"
	_, err := http.Post(WiremockAdminURL+"/requests/reset", "application/json", nil)
	require.NoError(t, err)
}

func VerifyRequestCount(
	t *testing.T,
	method string,
	urlPath string,
	queryParams map[string]string,
	expected int,
) {
	WiremockAdminURL := "http://localhost:8080/__admin"
	var reqBody bytes.Buffer
	reqBody.WriteString(`{"method":"`)
	reqBody.WriteString(method)
	reqBody.WriteString(`","urlPath":"`)
	reqBody.WriteString(urlPath)
	reqBody.WriteString(`"}`)
	if len(queryParams) > 0 {
		reqBody.WriteString(`,"queryParameters":{`)
		first := true
		for key, value := range queryParams {
			if !first {
				reqBody.WriteString(",")
			}
			reqBody.WriteString(`"`)
			reqBody.WriteString(key)
			reqBody.WriteString(`":{"equalTo":"`)
			reqBody.WriteString(value)
			reqBody.WriteString(`"}`)
			first = false
		}
		reqBody.WriteString("}")
	}
	resp, err := http.Post(WiremockAdminURL+"/requests/find", "application/json", &reqBody)
	require.NoError(t, err)
	var result struct {
		Requests []interface{} `json:"requests"`
	}
	json.NewDecoder(resp.Body).Decode(&result)
	require.Equal(t, expected, len(result.Requests))
}

func TestBoardingAddApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.AddApplicationRequest{
		ApplicationDataPayIn: &payabli.ApplicationDataPayIn{
			Services: &payabli.ApplicationDataPayInServices{
				Ach: &payabli.ApplicationDataPayInServicesAch{},
				Card: &payabli.ApplicationDataPayInServicesCard{
					AcceptAmex: payabli.Bool(
						true,
					),
					AcceptDiscover: payabli.Bool(
						true,
					),
					AcceptMastercard: payabli.Bool(
						true,
					),
					AcceptVisa: payabli.Bool(
						true,
					),
				},
			},
			AnnualRevenue: payabli.Float64(
				1000,
			),
			AverageBillSize: payabli.String(
				"500",
			),
			AverageMonthlyBill: payabli.String(
				"5650",
			),
			Avgmonthly: payabli.Float64(
				1000,
			),
			Baddress: payabli.String(
				"123 Walnut Street",
			),
			Baddress1: payabli.String(
				"Suite 103",
			),
			BankData: &payabli.ApplicationDataPayInBankData{},
			Bcity: payabli.String(
				"New Vegas",
			),
			Bcountry: payabli.String(
				"US",
			),
			Binperson: payabli.Int(
				60,
			),
			Binphone: payabli.Int(
				20,
			),
			Binweb: payabli.Int(
				20,
			),
			Bstate: payabli.String(
				"FL",
			),
			Bsummary: payabli.String(
				"Brick and mortar store that sells office supplies",
			),
			Btype: payabli.OwnTypeLimitedLiabilityCompany.Ptr(),
			Bzip: payabli.String(
				"33000",
			),
			Contacts: []*payabli.ApplicationDataPayInContactsItem{
				&payabli.ApplicationDataPayInContactsItem{
					ContactEmail: payabli.String(
						"herman@hermanscoatings.com",
					),
					ContactName: payabli.String(
						"Herman Martinez",
					),
					ContactPhone: payabli.String(
						"3055550000",
					),
					ContactTitle: payabli.String(
						"Owner",
					),
				},
			},
			CreditLimit: payabli.String(
				"creditLimit",
			),
			DbaName: payabli.String(
				"Sunshine Gutters",
			),
			Ein: payabli.String(
				"123456789",
			),
			Faxnumber: payabli.String(
				"1234567890",
			),
			Highticketamt: payabli.Float64(
				1000,
			),
			LegalName: payabli.String(
				"Sunshine Services, LLC",
			),
			License: payabli.String(
				"2222222FFG",
			),
			Licstate: payabli.String(
				"CA",
			),
			Maddress: payabli.String(
				"123 Walnut Street",
			),
			Maddress1: payabli.String(
				"STE 900",
			),
			Mcc: payabli.String(
				"7777",
			),
			Mcity: payabli.String(
				"Johnson City",
			),
			Mcountry: payabli.String(
				"US",
			),
			Mstate: payabli.String(
				"TN",
			),
			Mzip: payabli.String(
				"37615",
			),
			OrgId: payabli.Int64(
				123,
			),
			Ownership: []*payabli.ApplicationDataPayInOwnershipItem{
				&payabli.ApplicationDataPayInOwnershipItem{
					Oaddress: payabli.String(
						"33 North St",
					),
					Ocity: payabli.String(
						"Any City",
					),
					Ocountry: payabli.String(
						"US",
					),
					Odriverstate: payabli.String(
						"CA",
					),
					Ostate: payabli.String(
						"CA",
					),
					Ownerdob: payabli.String(
						"01/01/1990",
					),
					Ownerdriver: payabli.String(
						"CA6677778",
					),
					Owneremail: payabli.String(
						"test@email.com",
					),
					Ownername: payabli.String(
						"John Smith",
					),
					Ownerpercent: payabli.Int(
						100,
					),
					Ownerphone1: payabli.String(
						"555888111",
					),
					Ownerphone2: payabli.String(
						"555888111",
					),
					Ownerssn: payabli.String(
						"123456789",
					),
					Ownertitle: payabli.String(
						"CEO",
					),
					Ozip: payabli.String(
						"55555",
					),
				},
			},
			Phonenumber:      "1234567890",
			ProcessingRegion: "US",
			RecipientEmail: payabli.String(
				"josephray@example.com",
			),
			RecipientEmailNotification: payabli.Bool(
				true,
			),
			Resumable: payabli.Bool(
				true,
			),
			Signer: &payabli.SignerDataRequest{
				Address: payabli.String(
					"33 North St",
				),
				Address1: payabli.String(
					"STE 900",
				),
				City: payabli.String(
					"Bristol",
				),
				Country: payabli.String(
					"US",
				),
				Dob: payabli.String(
					"01/01/1976",
				),
				Email: payabli.String(
					"test@email.com",
				),
				Name: payabli.String(
					"John Smith",
				),
				Phone: payabli.String(
					"555888111",
				),
				Ssn: payabli.String(
					"123456789",
				),
				State: payabli.String(
					"TN",
				),
				Zip: payabli.String(
					"55555",
				),
				PciAttestation: payabli.Bool(
					true,
				),
				SignedDocumentReference: payabli.String(
					"https://example.com/signed-document.pdf",
				),
				AttestationDate: payabli.String(
					"04/20/2025",
				),
				SignDate: payabli.String(
					"04/20/2025",
				),
				AdditionalData: payabli.String(
					`{"deviceId":"499585-389fj484-3jcj8hj3","session":"fifji4-fiu443-fn4843","timeWithCompany":"6 Years"}`,
				),
			},
			Startdate: payabli.String(
				"01/01/1990",
			),
			TaxFillName: payabli.String(
				"Sunshine LLC",
			),
			TemplateId: payabli.Int64(
				22,
			),
			Ticketamt: payabli.Float64(
				1000,
			),
			Website: payabli.String(
				"www.example.com",
			),
			WhenCharged:   payabli.WhenchargedWhenServiceProvided,
			WhenDelivered: payabli.WhendeliveredOver30Days,
			WhenProvided:  payabli.WhenprovidedThirtyDaysOrLess,
			WhenRefunded:  payabli.WhenrefundedThirtyDaysOrLess,
		},
	}
	_, invocationErr := client.Boarding.AddApplication(
		context.TODO(),
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "POST", "/Boarding/app", nil, 1)
}

func TestBoardingDeleteApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Boarding.DeleteApplication(
		context.TODO(),
		352,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "DELETE", "/Boarding/app/352", nil, 1)
}

func TestBoardingGetApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Boarding.GetApplication(
		context.TODO(),
		352,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Boarding/read/352", nil, 1)
}

func TestBoardingGetApplicationByAuthWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.RequestAppByAuth{
		Email: payabli.String(
			"admin@email.com",
		),
		ReferenceId: payabli.String(
			"n6UCd1f1ygG7",
		),
	}
	_, invocationErr := client.Boarding.GetApplicationByAuth(
		context.TODO(),
		"17E",
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "POST", "/Boarding/read/17E", nil, 1)
}

func TestBoardingGetByIdLinkApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Boarding.GetByIdLinkApplication(
		context.TODO(),
		91,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Boarding/linkbyId/91", nil, 1)
}

func TestBoardingGetByTemplateIdLinkApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Boarding.GetByTemplateIdLinkApplication(
		context.TODO(),
		80,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Boarding/linkbyTemplate/80", nil, 1)
}

func TestBoardingGetExternalApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.GetExternalApplicationRequest{}
	_, invocationErr := client.Boarding.GetExternalApplication(
		context.TODO(),
		352,
		"mail2",
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "PUT", "/Boarding/applink/352/mail2", nil, 1)
}

func TestBoardingGetLinkApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	_, invocationErr := client.Boarding.GetLinkApplication(
		context.TODO(),
		"myorgaccountname-00091",
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Boarding/link/myorgaccountname-00091", nil, 1)
}

func TestBoardingListApplicationsWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.ListApplicationsRequest{
		FromRecord: payabli.Int(
			251,
		),
		LimitRecord: payabli.Int(
			0,
		),
		SortBy: payabli.String(
			"desc(field_name)",
		),
	}
	_, invocationErr := client.Boarding.ListApplications(
		context.TODO(),
		123,
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Query/boarding/123", map[string]string{"fromRecord": "251", "limitRecord": "0", "sortBy": "desc(field_name)"}, 1)
}

func TestBoardingListBoardingLinksWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.ListBoardingLinksRequest{
		FromRecord: payabli.Int(
			251,
		),
		LimitRecord: payabli.Int(
			0,
		),
		SortBy: payabli.String(
			"desc(field_name)",
		),
	}
	_, invocationErr := client.Boarding.ListBoardingLinks(
		context.TODO(),
		123,
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "GET", "/Query/boardinglinks/123", map[string]string{"fromRecord": "251", "limitRecord": "0", "sortBy": "desc(field_name)"}, 1)
}

func TestBoardingUpdateApplicationWithWireMock(
	t *testing.T,
) {
	ResetWireMockRequests(t)
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &payabli.ApplicationData{}
	_, invocationErr := client.Boarding.UpdateApplication(
		context.TODO(),
		352,
		request,
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "PUT", "/Boarding/app/352", nil, 1)
}
